<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decode+</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* --- AESTHETIC REVAMP --- */
    :root {
        --primary-hue: 125; /* Green */
        --primary-color: hsl(var(--primary-hue), 45%, 48%);
        --primary-dark: hsl(var(--primary-hue), 45%, 38%);
        --primary-light: hsl(var(--primary-hue), 50%, 94%);
        --background-color: #f8f9fc;
        --surface-color: #ffffff;
        --text-color: #2c3e50;
        --text-muted: #8492a6;
        --border-color: #e0e6ed;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --font-family: 'Poppins', sans-serif;
        --border-radius-sm: 4px;
        --border-radius-md: 8px;
        --transition-speed: 0.2s ease;
    }

    /* --- Base & Typography --- */
    *, *::before, *::after {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        font-family: var(--font-family);
        background: var(--background-color);
        color: var(--text-color);
        font-weight: 400;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .main-wrapper {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    h2, h3, h4 {
        font-weight: 600;
        color: var(--text-color);
        margin-top: 0;
    }
    h2 { font-size: 1.75rem; }
    h3 { font-size: 1.25rem; color: var(--primary-dark); }
    h4 { font-size: 1rem; font-weight: 500;}

    hr {
        border: none;
        border-top: 1px solid var(--border-color);
        margin: 1.5rem 0;
    }

    /* --- Custom Scrollbar --- */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--background-color); }
    ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #bbb; }

    /* --- Top Navigation --- */
    nav {
        width: 100%; 
        background: var(--primary-dark);
        color: white;
        display: flex;
        flex-direction: row; 
        align-items: center; 
        justify-content: space-between; 
        padding: 0 24px; 
        flex-shrink: 0;
        box-shadow: var(--shadow-lg);
        z-index: 100;
        position: sticky; 
        top: 0; 
    }
    .nav-buttons { 
        flex-grow: 1; 
        display: flex; 
        align-items: center;
    }
    nav h2 {
        text-align: center;
        margin: 0;
        padding: 16px 0; 
        background: transparent; 
        font-size: 1.5rem;
        font-weight: 600;
        color: white;
        margin-right: 24px; 
    }
    nav button {
        padding: 20px 16px; 
        border: none;
        background: transparent;
        color: rgba(255, 255, 255, 0.8);
        text-align: left;
        font-size: 1rem;
        font-family: var(--font-family);
        cursor: pointer;
        transition: all var(--transition-speed);
        border-bottom: 4px solid transparent; 
        width: auto; 
    }
    nav button:hover {
        background: rgba(255,255,255,0.05);
        color: white;
    }
    nav button.active {
        background: var(--primary-color);
        color: white;
        font-weight: 600;
        border-bottom: 4px solid white; 
        border-left: none; 
    }
    .nav-buttons button .icon {
        margin-right: 8px;
    }
    
    .nav-right-controls {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    /* --- Content Area --- */
    .content {
        flex: 1;
        padding: 32px;
        overflow: hidden;
        min-height: 0; 
    }
    .tab {
        display: none;
        height: 100%;
        flex-direction: column;
    }
    .tab.active {
        display: flex;
    }
    .tab > h2 { 
        margin-bottom: 24px;
        flex-shrink: 0;
    }
    
    /* --- Forms & Buttons --- */
    input[type="text"], input[type="date"], select, textarea {
        padding: 10px 14px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-md);
        font-size: 1rem;
        font-family: var(--font-family);
        transition: all var(--transition-speed);
        background-color: var(--surface-color);
        width: 100%;
    }
    textarea {
        resize: vertical;
        min-height: 80px;
    }
    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px hsla(var(--primary-hue), 45%, 48%, 0.2);
    }
    
    button {
      font-family: var(--font-family);
      cursor: pointer;
      transition: all var(--transition-speed);
    }
    
    .primary-btn, .secondary-btn {
        padding: 10px 20px;
        border: none;
        color: white;
        border-radius: var(--border-radius-md);
        font-weight: 500;
        font-size: 1rem;
        box-shadow: var(--shadow);
    }
    .primary-btn { background: var(--primary-color); }
    .primary-btn:hover { 
        background: var(--primary-dark); 
        box-shadow: var(--shadow-lg);
        transform: translateY(-2px);
    }
    .secondary-btn {
        background: var(--surface-color);
        color: var(--primary-dark);
        border: 1px solid var(--primary-color);
    }
    .secondary-btn:hover {
        background: var(--primary-light);
        box-shadow: var(--shadow-lg);
    }
    
    /* --- Main Containers & Lists --- */
    .subjects-container, .notes-container, .quizzes-container {
        display: flex;
        flex-grow: 1; 
        min-height: 0; 
    }
    .subject-list, .note-list, .quiz-subject-list {
        width: 280px;
        border-right: 1px solid var(--border-color);
        padding: 16px;
        display: flex;
        flex-direction: column;
        background: var(--surface-color);
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow);
    }
    .subject-list input, .note-list input { width: 100%; box-sizing: border-box; margin-bottom: 8px;}
    .subject-list button, .note-list button { width: 100%; flex-shrink: 0; }
    
    .list-scroll-area {
        flex-grow: 1;
        overflow-y: auto;
        min-height: 0;
        margin-top: 1rem;
    }

    .subject-item, .note-item, .quiz-subject-item {
        padding: 0 12px;
        margin: 4px 0;
        border-radius: var(--border-radius-md);
        cursor: pointer;
        font-weight: 500;
        color: var(--text-muted);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all var(--transition-speed);
    }

    .subject-item .subject-name, .note-item .note-name, .quiz-subject-item .subject-name {
        flex-grow: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding: 12px 0;
    }

    .subject-item:hover, .note-item:hover, .quiz-subject-item:hover { background: var(--primary-light); color: var(--primary-dark); }
    .subject-item.active, .note-item.active, .quiz-subject-item.active {
        background: var(--primary-color);
        color: white;
        font-weight: 500;
        box-shadow: var(--shadow);
    }
    
    .lectures-area, .note-editor-area, .quizzes-area {
        flex: 1;
        padding-left: 24px;
        display: flex;
        flex-direction: column;
        min-height: 0;
    }
    .lectures-area > h3, .note-editor-area > h3, .quizzes-area > h3 {
        margin-bottom: 16px;
        flex-shrink: 0;
    }
    
    /* --- Actions Dropdown Menu --- */
    .actions-container { position: relative; flex-shrink: 0; }
    .actions-menu-btn {
        background: transparent;
        border: none;
        cursor: pointer;
        font-size: 1.25rem;
        font-weight: bold;
        padding: 4px 8px;
        line-height: 1;
        border-radius: var(--border-radius-md);
        color: var(--text-muted);
    }
    .subject-item.active .actions-menu-btn, .note-item.active .actions-menu-btn, .quiz-subject-item.active .actions-menu-btn { color: white; }
    .subject-item:hover .actions-menu-btn, .note-item:hover .actions-menu-btn, .task-card:hover .actions-menu-btn, .quiz-subject-item:hover .actions-menu-btn { color: var(--primary-dark); }
    .actions-menu-btn:hover { background-color: rgba(0,0,0,0.1); }
    .actions-menu {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background-color: var(--surface-color);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow-lg);
        z-index: 10;
        width: 160px;
        padding: 4px 0;
        overflow: hidden;
        animation: fadeIn 0.1s ease-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }
    .actions-menu.show { display: block; }
    .actions-menu-item {
        display: block;
        padding: 10px 14px;
        cursor: pointer;
        font-size: 0.95rem;
        color: var(--text-color);
        background: none;
        border: none;
        width: 100%;
        text-align: left;
    }
    .actions-menu-item:hover { background-color: var(--primary-light); }
    .actions-menu-item.disabled { color: #aaa; cursor: not-allowed; background-color: transparent; }
    .actions-menu-item.active {
        background-color: var(--primary-light);
        font-weight: 600;
        color: var(--primary-dark);
    }

    /* --- Lecture Card --- */
    #lectureControls { align-items: center; }
    #lectureList { flex-grow: 1; overflow-y: auto; min-height: 0; } 
    .lecture-card {
      display: flex;
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-md);
      padding: 12px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
      align-items: center;
      transition: all var(--transition-speed);
    }
    .lecture-card:hover { 
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-color);
        transform: translateY(-2px);
    }
    .lecture-left iframe {
      width: 160px;
      height: 90px;
      border-radius: var(--border-radius-sm);
      border: 1px solid var(--border-color);
    }
    .lecture-right {
      flex: 1;
      margin-right: 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .lecture-title-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 8px; 
    }
    .lecture-title-header h4 { 
        margin: 0; 
        font-size: 0.95rem;
    }
    .lecture-actions { display: flex; gap: 8px; }
    .lecture-actions button {
        padding: 5px 10px;
        border-radius: var(--border-radius-sm);
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 500;
        border: none;
        transition: all var(--transition-speed);
    }
    .watch-btn { background: var(--primary-light); color: var(--primary-dark); }
    .watch-btn:hover { background: var(--primary-color); color: white; }
    .completed-btn { background-color: #e3f2fd; color: #1e88e5; }
    .completed-btn:hover { background-color: #1e88e5; color: white; }
    .completed-btn.completed { background-color: #e0e0e0; color: #757575; }
    .remove-btn { background: #ffcdd2; color: #c62828; }
    .remove-btn:hover { background: #c62828; color: white; }

    /* --- Task Scheduler --- */
    .task-form {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      background: var(--surface-color);
      padding: 16px;
      border-radius: var(--border-radius-md);
      box-shadow: var(--shadow);
      align-items: center;
      flex-shrink: 0; 
    }
    .task-form input[type="text"] {
        flex: 1 1 auto;
        width: auto;
    }
    .task-form input[type="date"],
    .task-form select,
    .task-form button {
        width: auto;
        flex-shrink: 0;
    }
    
    .task-board { 
        display: flex; 
        gap: 24px; 
        justify-content: space-between; 
        flex-grow: 1;
        min-height: 0;
    }
    .task-column {
      flex: 1;
      background: var(--surface-color);
      padding: 16px;
      border-radius: var(--border-radius-md);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
    }
    .task-column h3 { border-bottom: 1px solid var(--border-color); padding-bottom: 12px; margin-bottom: 16px; }
    .tasks-container { min-height: 0; flex-grow: 1; overflow-y: auto; }
    .task-card {
        background: var(--primary-light);
        padding: 12px;
        border-radius: var(--border-radius-md);
        margin-bottom: 12px;
        box-shadow: none;
        border: 1px solid var(--border-color);
        border-left: 5px solid;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .task-card-content { flex-grow: 1; }
    .task-card.priority-high { border-left-color: #ef5350; }
    .task-card.priority-medium { border-left-color: #ffca28; }
    .task-card.priority-low { border-left-color: #66bb6a; }
    .task-card p { margin: 0 0 4px; font-weight: 500; font-size: 0.95rem;}
    .task-card .task-meta { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0; }
    .task-card.done { text-decoration: line-through; opacity: 0.7; background: #e8f5e9; }

    /* --- Notes Editor --- */
    .note-editor-area #noteEditorContainer {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        min-height: 0;
    }
    .note-toolbar {
        background: var(--surface-color);
        padding: 8px;
        border: 1px solid var(--border-color);
        border-bottom: none;
        border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
        display: flex;
        gap: 4px;
        align-items: center;
    }
    .note-toolbar button {
        padding: 6px 12px;
        border-radius: var(--border-radius-md);
        border: none;
        background: transparent;
    }
    .note-toolbar button:hover { background: var(--primary-light); color: var(--primary-dark); }
    .note-toolbar .remove-btn {
        margin-left: auto;
        font-weight: 500;
        font-size: 0.9rem;
    }
    .note-toolbar .remove-btn:hover {
        background: #ffcdd2;
        color: #c62828;
    }
    #notes-editor {
        width: 100%;
        flex-grow: 1;
        box-sizing: border-box;
        border: 1px solid var(--border-color);
        border-radius: 0 0 var(--border-radius-md) var(--border-radius-md);
        padding: 16px;
        font-size: 1rem;
        line-height: 1.6;
        font-family: var(--font-family);
        overflow-y: auto;
        background: var(--surface-color);
    }
    #notes-editor:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px hsla(var(--primary-hue), 45%, 48%, 0.2);
    }

    /* --- Progress Tab Styles --- */
    .progress-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }
    #progress .progress-container {
      height: 100%;
      overflow-y: auto;
    }
    .summary-card {
        background-color: var(--surface-color);
        padding: 16px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow);
        text-align: center;
        transition: all var(--transition-speed);
    }
    .summary-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-lg);
    }
    .summary-card .count {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
    }
    .summary-card .label {
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-top: 4px;
    }
    .progress-bar-container {
        width: 100%;
        height: 24px;
        background-color: var(--border-color);
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        margin-top: 16px;
    }
    .progress-bar-fill {
        height: 100%;
        background-color: var(--primary-color);
        border-radius: 12px;
        transition: width 0.5s ease-in-out;
    }
    .progress-bar-label {
        position: absolute;
        width: 100%;
        text-align: center;
        line-height: 24px;
        color: white;
        font-weight: 500;
        font-size: 0.8rem;
    }
    #subjectProgressList .subject-progress-item {
        background-color: var(--surface-color);
        padding: 16px;
        border-radius: var(--border-radius-md);
        margin-bottom: 16px;
        box-shadow: var(--shadow);
    }
    .subject-progress-item h4 {
        margin-bottom: 8px;
    }

    /* --- DASHBOARD STYLES --- */
    #dashboard .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
        flex-grow: 1;
        min-height: 0;
        overflow-y: auto;
    }
    .dashboard-main, .dashboard-side {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }
    .dashboard-card {
        background-color: var(--surface-color);
        padding: 24px;
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow);
    }
    .dashboard-tasks .task-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-color);
    }
    .dashboard-tasks .task-item:last-child {
        border-bottom: none;
    }
    .dashboard-tasks .task-name {
        font-weight: 500;
    }
    .dashboard-tasks .task-due-date {
        color: var(--text-muted);
        font-size: 0.9rem;
    }

    /* --- QUIZZES TAB STYLES (REDESIGNED) --- */
    .quiz-management-view {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 24px;
        flex-grow: 1;
        min-height: 0;
    }
    #flashcardForm {
        display: flex;
        flex-direction: column;
        gap: 16px;
        padding: 24px;
        background: var(--surface-color);
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow);
        align-self: flex-start;
    }
    #existingFlashcardsContainer {
        display: flex;
        flex-direction: column;
        min-height: 0;
    }
    #existingFlashcardsList {
        flex-grow: 1;
        overflow-y: auto;
    }
    .flashcard-list-item {
        background: var(--surface-color);
        padding: 12px 16px;
        border-radius: var(--border-radius-md);
        margin-bottom: 12px;
        box-shadow: var(--shadow);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .flashcard-list-item p {
        margin: 0;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .flashcard-list-actions button {
        background: none;
        border: none;
        font-size: 1rem;
        cursor: pointer;
        padding: 4px;
        color: var(--text-muted);
    }
    .flashcard-list-actions button:hover {
        color: var(--primary-dark);
    }

    .quiz-session-view {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex-grow: 1;
        padding-bottom: 50px; /* Space for buttons */
    }
    #quiz-progress-bar-container {
        width: 100%;
        max-width: 600px;
        height: 8px;
        background: var(--border-color);
        border-radius: 4px;
        margin-bottom: 16px;
    }
    #quiz-progress-bar {
        width: 0%;
        height: 100%;
        background: var(--primary-color);
        border-radius: 4px;
        transition: width var(--transition-speed);
    }
    #quiz-card-counter {
        font-weight: 500;
        color: var(--text-muted);
        margin-bottom: 24px;
    }
    .flashcard {
        width: 100%;
        max-width: 600px;
        height: 350px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s;
        cursor: pointer;
    }
    .flashcard.is-flipped {
        transform: rotateY(180deg);
    }
    .flashcard-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
        font-size: 1.75rem;
        background: var(--surface-color);
        box-shadow: var(--shadow-lg);
        border-radius: var(--border-radius-md);
        border: 1px solid var(--border-color);
        text-align: center;
    }
    .flashcard-face--back {
        transform: rotateY(180deg);
        background: var(--primary-light);
        font-size: 1.5rem;
    }
    .quiz-session-controls {
        margin-top: 24px;
        display: flex;
        gap: 16px;
    }
    .quiz-session-controls button {
        padding: 12px 24px;
        font-size: 1rem;
        font-weight: 600;
    }
    .quiz-know-btn {
        background-color: var(--primary-light);
        color: var(--primary-dark);
    }
    .quiz-know-btn:hover {
        background-color: var(--primary-color);
        color: white;
    }
    .quiz-dont-know-btn {
        background-color: #ffcdd2;
        color: #c62828;
    }
     .quiz-dont-know-btn:hover {
        background-color: #c62828;
        color: white;
    }
    .quiz-results-view {
        text-align: center;
    }


    /* --- POMODORO TIMER STYLES (MODIFIED) --- */
    .pomodoro-timer {
        display: flex; 
        align-items: center; 
        gap: 8px; 
        color: white;
    }
    .pomodoro-timer .actions-menu-btn { 
        color: white;
    }
    .pomodoro-timer .actions-menu-btn:hover {
        background-color: rgba(255,255,255,0.2);
    }
    
    #pomodoro-display {
        font-size: 1.8rem;
        font-weight: 600;
        flex-shrink: 0;
    }

    /* --- Footer Styles --- */
    footer {
        padding: 24px;
        background-color: var(--surface-color);
        text-align: center;
        color: var(--text-muted);
        border-top: 1px solid var(--border-color);
        font-size: 0.9rem;
    }

    /* Media Query for Mobile Responsive Menu */
    @media (max-width: 768px) {
        nav {
            padding: 0 16px;
        }
        nav h2 {
            display: none; /* Hide title on small screens */
        }
        .nav-buttons button .text {
            display: none; /* Hide text, show only icon */
        }
        .nav-buttons button .icon {
            margin-right: 0; /* Remove margin when text is hidden */
        }
        .nav-buttons button {
            padding: 20px 12px;
        }
    }

  </style>
</head>
<body>

  <div class="main-wrapper">
    <nav>
      <div class="nav-buttons">
          <h2>üìö Decode+</h2>
          <button class="active" onclick="openTab(event, 'dashboard')"><span class="icon">üè†</span><span class="text"> Dashboard</span></button>
          <button onclick="openTab(event, 'subjects')"><span class="icon">üìñ</span><span class="text"> Subjects</span></button>
          <button onclick="openTab(event, 'notes')"><span class="icon">üìî</span><span class="text"> Notes</span></button>
          <button onclick="openTab(event, 'tasks')"><span class="icon">üìÖ</span><span class="text"> Tasks</span></button>
          <button onclick="openTab(event, 'quizzes')"><span class="icon">üìù</span><span class="text"> Quizzes</span></button>
          <button onclick="openTab(event, 'progress')"><span class="icon">üìä</span><span class="text"> Progress</span></button>
      </div>
      <div class="nav-right-controls">
        <div class="pomodoro-timer">
            <div id="pomodoro-display">25:00</div>
            <div class="actions-container">
                <button class="actions-menu-btn" onclick="toggleActionMenu(event)">‚ãÆ</button>
                <div class="actions-menu">
                    <button class="actions-menu-item" id="pomodoro-start">Start</button>
                    <button class="actions-menu-item" id="pomodoro-reset">Reset</button>
                    <hr style="margin: 4px 0;">
                    <button class="actions-menu-item" id="pomodoro-mode" onclick="setPomodoroMode('pomodoro')">Pomodoro</button>
                    <button class="actions-menu-item" id="short-break-mode" onclick="setPomodoroMode('shortBreak')">Short Break</button>
                    <button class="actions-menu-item" id="long-break-mode" onclick="setPomodoroMode('longBreak')">Long Break</button>
                </div>
            </div>
        </div>
        <button class="secondary-btn" id="saveButton" style="display: none; padding: 8px 12px; font-size: 0.9rem;">‚òÅÔ∏è Save to Cloud</button>
        <button class="primary-btn" id="authButton" style="padding: 8px 12px; font-size: 0.9rem;">Login</button>
      </div>
    </nav>

    <div class="content">
      <div id="dashboard" class="tab active">
        </div>
      <div id="subjects" class="tab">
        <h2>Subjects & Lectures</h2>
        <div class="subjects-container">
          <div class="subject-list">
            <input id="subjectName" type="text" placeholder="Add New Subject">
            <button class="primary-btn" onclick="addSubject()">+ Add Subject</button>
            <div class="list-scroll-area">
              <hr>
              <div id="subjectList"></div>
            </div>
          </div>
          <div class="lectures-area">
            <h3 id="subjectTitle">Select a subject to view lectures</h3>
            <div id="lectureControls" style="display:none; gap: 10px; margin-bottom: 10px; flex-shrink: 0;">
              <input id="lectureUrl" type="text" placeholder="YouTube link" style="flex: 1;">
              <input id="lectureTitle" type="text" placeholder="Lecture title" style="flex: 1;">
              <button class="primary-btn" onclick="addLecture()">+ Add</button>
            </div>
            <hr id="lectureHr" style="display: none; flex-shrink: 0;">
            <div id="lectureList"></div>
          </div>
        </div>
      </div>
      <div id="quizzes" class="tab">
          <h2>Quizzes & Flashcards</h2>
          <div class="quizzes-container">
              <div class="quiz-subject-list">
                  <h3>Select a Subject</h3>
                  <div class="list-scroll-area">
                      <div id="quizSubjectList"></div>
                  </div>
              </div>
              <div class="quizzes-area">
                  <h3 id="quizSubjectTitle">Select a subject to manage flashcards</h3>
                  <div id="quizContent" style="display: none; flex-grow: 1; min-height: 0; display: flex; flex-direction: column;">
                      </div>
              </div>
          </div>
      </div>
      <div id="progress" class="tab">
        </div>
      <div id="notes" class="tab">
        <h2>My Notes</h2>
        <div class="notes-container">
          <div class="note-list">
            <input id="noteTitleInput" type="text" placeholder="New Note Title">
            <button class="primary-btn" onclick="addNote()">+ Add Note</button>
            <div class="list-scroll-area">
              <hr>
              <div id="notesList"></div>
            </div>
          </div>
          <div class="note-editor-area">
            <h3 id="currentNoteTitle">Select a note to get started</h3>
            <div id="noteEditorContainer" style="display:none;">
                <div class="note-toolbar">
                    <button title="Bold" onclick="formatDoc('bold')"><b>B</b></button>
                    <button title="Bulleted List" onclick="formatDoc('insertUnorderedList')">‚óè</button>
                    <button title="Numbered List" onclick="formatDoc('insertOrderedList')">1.</button>
                    <button title="Highlight" onclick="formatDoc('backColor', '#FFFFA7')">üé®</button>
                    <button title="Remove Highlight" onclick="formatDoc('backColor', 'white')">üö´</button>
                    <button class="remove-btn" onclick="deleteCurrentNote()">Delete Note</button>
                </div>
                <div id="notes-editor" contenteditable="true"></div>
            </div>
          </div>
        </div>
      </div>
      <div id="tasks" class="tab">
        <h2>Task Scheduler</h2>
        <div class="task-form">
          <input type="text" id="taskInput" placeholder="New task description...">
          <input type="date" id="taskDueDate">
          <select id="taskPriority">
            <option value="low">Low Priority</option>
            <option value="medium">Medium Priority</option>
            <option value="high">High Priority</option>
          </select>
          <button class="primary-btn" onclick="addTask()">+ Add Task</button>
        </div>
        <div class="task-board">
          <div class="task-column">
            <h3>To Do</h3>
            <div class="tasks-container" id="todo-tasks"></div>
          </div>
          <div class="task-column">
            <h3>In Progress</h3>
            <div class="tasks-container" id="inprogress-tasks"></div>
          </div>
          <div class="task-column">
            <h3>Done</h3>
            <div class="tasks-container" id="done-tasks"></div>
          </div>
        </div>
      </div>
    </div>
  </div><footer>
      <p>&copy; 2025 Decode+. All rights reserved.</p>
  </footer>

  <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

  <script>
    // --- 1. GOOGLE DRIVE API SETUP ---
    const CLIENT_ID = '938237083591-f237ct41avtntpk32lmvst40cdlsfebi.apps.googleusercontent.com';
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';
    const APP_DATA_FILE_NAME = 'decodePlusData.json';

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;
    let appDataFileId = null;

    const authButton = document.getElementById('authButton');
    const saveButton = document.getElementById('saveButton');
    
    // --- 2. INITIALIZATION ---

    function gapiLoaded() {
      gapi.load('client', initializeGapiClient);
    }

    async function initializeGapiClient() {
      await gapi.client.init({
        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
      });
      gapiInited = true;
      maybeEnableButtons();
    }

    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: handleAuthResponse,
      });
      gisInited = true;
      maybeEnableButtons();
    }

    function maybeEnableButtons() {
      if (gapiInited && gisInited) {
        authButton.disabled = false;
        authButton.innerText = 'Login';
      }
    }

    // --- 3. AUTHENTICATION ---

    function handleAuthClick() {
      if (gapi.client.getToken() === null) {
        authButton.disabled = true;
        authButton.innerText = 'Logging in...';
        tokenClient.requestAccessToken({ prompt: 'consent' });
      } else {
        gapi.client.setToken('');
        authButton.innerText = 'Login';
        saveButton.style.display = 'none';
        subjects = []; notes = []; tasks = [];
        appDataFileId = null;
        renderAll();
        alert('You have been logged out.');
      }
    }
    
    async function handleAuthResponse(resp) {
      if (resp.error) {
        alert('An error occurred during login. Please try again.');
        console.error('Login Error:', resp);
        authButton.disabled = false;
        authButton.innerText = 'Login';
        return;
      }
      gapi.client.setToken(resp);
      authButton.innerText = 'Logout';
      authButton.disabled = false;
      saveButton.style.display = 'block';
      await loadDataFromDrive();
    }

    // --- 4. DATA STORAGE (GOOGLE DRIVE) ---

    async function saveDataToDrive() {
        if (!gapi.client.getToken()) return alert("Please log in before saving.");
        saveButton.disabled = true; saveButton.innerText = 'Saving...';
        
        const allData = { subjects, notes, tasks };
        const fileContent = JSON.stringify(allData, null, 2);

        try {
            if (!appDataFileId) appDataFileId = await findFileId();
            
            const boundary = '-------314159265358979323846';
            const delimiter = `\r\n--${boundary}\r\n`;
            const close_delim = `\r\n--${boundary}--`;

            const metadata = { name: APP_DATA_FILE_NAME, mimeType: 'application/json' };
            const multipartRequestBody = delimiter + 'Content-Type: application/json\r\n\r\n' + JSON.stringify(metadata) + delimiter + 'Content-Type: application/json\r\n\r\n' + fileContent + close_delim;

            const request = gapi.client.request({
                path: `/upload/drive/v3/files/${appDataFileId || ''}`,
                method: appDataFileId ? 'PATCH' : 'POST',
                params: { uploadType: 'multipart' },
                headers: { 'Content-Type': `multipart/related; boundary="${boundary}"` },
                body: multipartRequestBody
            });

            const response = await request;
            appDataFileId = response.result.id;
            alert('Data saved to Google Drive!');
        } catch (error) {
            alert('Error saving data. See console for details.');
            console.error('Save Error:', error);
        } finally {
            saveButton.disabled = false; saveButton.innerText = '‚òÅÔ∏è Save to Cloud';
        }
    }

    async function loadDataFromDrive() {
        appDataFileId = await findFileId();
        if (!appDataFileId) {
            console.log('No data file found. Starting fresh.');
            return renderAll();
        }
        try {
            const response = await gapi.client.drive.files.get({ fileId: appDataFileId, alt: 'media' });
            const data = response.result;
            subjects = data.subjects || [];
            notes = data.notes || [];
            tasks = data.tasks || [];
            subjects.forEach(s => s.flashcards = s.flashcards || []);
            alert('Data successfully loaded from Google Drive!');
        } catch (error) {
            alert('Could not load data from Google Drive.');
            console.error('Load Error:', error);
        } finally {
            renderAll();
        }
    }

    async function findFileId() {
      try {
        const response = await gapi.client.drive.files.list({
          q: `name='${APP_DATA_FILE_NAME}' and trashed=false`, spaces: 'drive', fields: 'files(id, name)'
        });
        const files = response.result.files;
        return (files && files.length > 0) ? files[0].id : null;
      } catch (error) { console.error('Find File Error:', error); return null; }
    }

    // --- 5. CORE APP LOGIC ---

    // [ The rest of your app's functions: openTab, renderAll, addSubject, etc. go here. ]
    // [ They are unchanged from your file. I am omitting them for brevity. ]
    // [ Make sure all your original functions are present after this comment. ]
    function openTab(event, id) {
      document.querySelectorAll('nav .nav-buttons button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.currentTarget.classList.add('active');
      document.getElementById(id).classList.add('active');
      if (id === 'progress') renderProgress();
      if (id === 'dashboard') renderDashboard();
      if (id === 'quizzes') renderQuizUI();
    }
    function renderAll() {
        renderSubjects(); renderNotesList(); renderTasks(); renderDashboard(); renderProgress(); renderQuizUI();
        currentSubject = null; currentNoteId = null;
        document.getElementById('subjectTitle').innerText = "Select a subject";
        document.getElementById('lectureControls').style.display = "none";
        document.getElementById('lectureHr').style.display = "none";
        document.getElementById('lectureList').innerHTML = "";
        document.getElementById('currentNoteTitle').innerText = "Select a note to get started";
        document.getElementById('notes-editor').innerHTML = '';
        document.getElementById('noteEditorContainer').style.display = 'none';
    }
    function toggleActionMenu(event) {
        event.stopPropagation();
        closeAllActionMenus(event.currentTarget);
        event.currentTarget.nextElementSibling.classList.toggle('show');
    }
    function closeAllActionMenus(exceptElement = null) {
        document.querySelectorAll('.actions-menu.show').forEach(menu => {
            if (!exceptElement || !exceptElement.parentElement.contains(menu)) menu.classList.remove('show');
        });
    }
    window.addEventListener('click', () => closeAllActionMenus());
    let subjects = []; let currentSubject = null;
    let notes = []; let currentNoteId = null;
    let tasks = [];
    function addSubject() {
      const name = document.getElementById('subjectName').value.trim();
      if (!name) return alert("Enter subject name");
      subjects.push({ name, lectures: [], flashcards: [] });
      document.getElementById('subjectName').value = "";
      renderSubjects();
    }
    function renderSubjects() {
      const list = document.getElementById('subjectList');
      if (!list) return;
      list.innerHTML = "";
      subjects.forEach((s, i) => {
        const div = document.createElement("div");
        div.className = "subject-item" + (currentSubject === i ? " active" : "");
        const moveUpHTML = i > 0 ? `<button class="actions-menu-item" onclick="moveSubject(${i}, 'up', event)">Move Up</button>` : `<button class="actions-menu-item disabled" disabled>Move Up</button>`;
        const moveDownHTML = i < subjects.length - 1 ? `<button class="actions-menu-item" onclick="moveSubject(${i}, 'down', event)">Move Down</button>` : `<button class="actions-menu-item disabled" disabled>Move Down</button>`;
        div.innerHTML = `
            <span class="subject-name" onclick="selectSubject(${i})">${s.name}</span>
            <div class="actions-container">
                <button class="actions-menu-btn" onclick="toggleActionMenu(event)">‚ãÆ</button>
                <div class="actions-menu">
                    <button class="actions-menu-item" onclick="editSubject(${i}, event)">Edit Title</button>
                    ${moveUpHTML} ${moveDownHTML}
                    <button class="actions-menu-item" onclick="deleteSubject(${i}, event)">Delete</button>
                </div>
            </div>`;
        list.appendChild(div);
      });
    }
    function selectSubject(index) {
      currentSubject = index;
      document.getElementById('subjectTitle').innerText = subjects[index].name;
      document.getElementById('lectureControls').style.display = "flex";
      document.getElementById('lectureHr').style.display = "block";
      renderSubjects(); renderLectures();
    }
    function editSubject(index, event) {
        event.stopPropagation();
        const newName = prompt("Enter new name for subject:", subjects[index].name);
        if (newName && newName.trim() !== "") {
            subjects[index].name = newName.trim();
            if (currentSubject === index) document.getElementById('subjectTitle').innerText = subjects[index].name;
            renderSubjects();
        }
    }
    function deleteSubject(index, event) {
        event.stopPropagation();
        if (confirm(`Are you sure you want to delete "${subjects[index].name}"?`)) {
            if (currentSubject === index) {
                currentSubject = null;
                document.getElementById('subjectTitle').innerText = "Select a subject";
                document.getElementById('lectureControls').style.display = "none";
                document.getElementById('lectureHr').style.display = "none";
                document.getElementById('lectureList').innerHTML = "";
            } else if (currentSubject > index) {
                currentSubject--;
            }
            subjects.splice(index, 1);
            renderSubjects();
        }
    }
    function moveSubject(index, direction, event) {
        event.stopPropagation();
        if (direction === 'up' && index > 0) {
            [subjects[index], subjects[index - 1]] = [subjects[index - 1], subjects[index]];
            if (currentSubject === index) currentSubject--; else if (currentSubject === index - 1) currentSubject++;
        } else if (direction === 'down' && index < subjects.length - 1) {
            [subjects[index], subjects[index + 1]] = [subjects[index + 1], subjects[index]];
            if (currentSubject === index) currentSubject++; else if (currentSubject === index + 1) currentSubject--;
        }
        renderSubjects();
    }
    function addLecture() {
      if (currentSubject === null) return;
      const url = document.getElementById('lectureUrl').value.trim();
      const title = document.getElementById('lectureTitle').value.trim() || "Untitled";
      if (!url) return;
      subjects[currentSubject].lectures.push({ title, url, completed: false });
      document.getElementById('lectureUrl').value = "";
      document.getElementById('lectureTitle').value = "";
      renderLectures();
    }
    function renderLectures() {
      const list = document.getElementById('lectureList');
      list.innerHTML = "";
      if (currentSubject === null || !subjects[currentSubject]) return;
      subjects[currentSubject].lectures.forEach((lec, i) => {
        const div = document.createElement("div");
        div.className = "lecture-card";
        const moveUpHTML = i > 0 ? `<button class="actions-menu-item" onclick="moveLecture(${i}, 'up', event)">Up</button>` : `<button class="actions-menu-item disabled">Up</button>`;
        const moveDownHTML = i < subjects[currentSubject].lectures.length - 1 ? `<button class="actions-menu-item" onclick="moveLecture(${i}, 'down', event)">Down</button>` : `<button class="actions-menu-item disabled">Down</button>`;
        div.innerHTML = `
          <div class="lecture-right">
            <div class="lecture-title-header">
                <h4>${lec.completed ? "‚úî " : ""}${lec.title}</h4>
                <div class="actions-container">
                    <button class="actions-menu-btn" onclick="toggleActionMenu(event)">‚ãÆ</button>
                    <div class="actions-menu">
                        <button class="actions-menu-item" onclick="editLectureTitle(${i}, event)">Edit Title</button>
                        ${moveUpHTML} ${moveDownHTML}
                        <button class="actions-menu-item" onclick="removeLecture(${i}, event)">Remove</button>
                    </div>
                </div>
            </div>
            <div class="lecture-actions">
              <button class="watch-btn" onclick="window.open('${lec.url}', '_blank')">‚ñ∂ Watch</button>
              <button class="completed-btn ${lec.completed ? "completed" : ""}" onclick="toggleCompleted(${i})">${lec.completed ? "‚úî Completed" : "Mark Done"}</button>
            </div>
          </div>
          <div class="lecture-left"><iframe src="${convertToEmbed(lec.url)}"></iframe></div>`;
        list.appendChild(div);
      });
    }
    function toggleCompleted(i) {
      subjects[currentSubject].lectures[i].completed = !subjects[currentSubject].lectures[i].completed;
      renderLectures();
    }
    function removeLecture(i, event) {
      if (event) event.stopPropagation();
      subjects[currentSubject].lectures.splice(i, 1);
      renderLectures();
    }
    function editLectureTitle(i, event) {
        event.stopPropagation();
        const newTitle = prompt("Enter new title:", subjects[currentSubject].lectures[i].title);
        if (newTitle && newTitle.trim()) subjects[currentSubject].lectures[i].title = newTitle.trim();
        renderLectures();
    }
    function moveLecture(i, direction, event) {
        event.stopPropagation();
        const lectures = subjects[currentSubject].lectures;
        if (direction === 'up' && i > 0) [lectures[i], lectures[i - 1]] = [lectures[i - 1], lectures[i]];
        else if (direction === 'down' && i < lectures.length - 1) [lectures[i], lectures[i + 1]] = [lectures[i + 1], lectures[i]];
        renderLectures();
    }
    function convertToEmbed(url) {
      try {
        const u = new URL(url);
        if (u.hostname.includes("youtu.be")) return "https://www.youtube.com/embed/" + u.pathname.slice(1);
        if (u.searchParams.get("v")) return "https://www.youtube.com/embed/" + u.searchParams.get("v");
        return url;
      } catch { return url; }
    }
    function formatDoc(cmd, val = null) { document.execCommand(cmd, false, val); }
    function addNote() {
      const title = document.getElementById('noteTitleInput').value.trim();
      if (!title) return;
      const newNote = { id: Date.now(), title, content: `<p>New note: <b>${title}</b></p>` };
      notes.push(newNote);
      document.getElementById('noteTitleInput').value = '';
      renderNotesList();
      selectNote(newNote.id);
    }
    function selectNote(id) {
      currentNoteId = id;
      const note = notes.find(n => n.id === id);
      if (!note) return;
      document.getElementById('currentNoteTitle').innerText = note.title;
      document.getElementById('notes-editor').innerHTML = note.content;
      document.getElementById('noteEditorContainer').style.display = 'flex';
      renderNotesList();
    }
    function deleteCurrentNote() { if(currentNoteId) deleteNote(currentNoteId); }
    function deleteNote(id, event) {
      if (event) event.stopPropagation();
      const i = notes.findIndex(n => n.id === id);
      if (i === -1 || !confirm(`Delete "${notes[i].title}"?`)) return;
      notes.splice(i, 1);
      if (currentNoteId === id) {
        currentNoteId = null;
        document.getElementById('currentNoteTitle').innerText = "Select a note";
        document.getElementById('notes-editor').innerHTML = '';
        document.getElementById('noteEditorContainer').style.display = 'none';
      }
      renderNotesList();
    }
    function editNoteTitle(id, event) {
      event.stopPropagation();
      const note = notes.find(n => n.id === id);
      const newTitle = prompt("New title:", note.title);
      if (newTitle && newTitle.trim()) {
        note.title = newTitle.trim();
        if (currentNoteId === id) document.getElementById('currentNoteTitle').innerText = note.title;
        renderNotesList();
      }
    }
    function moveNote(id, direction, event) {
      event.stopPropagation();
      const i = notes.findIndex(n => n.id === id);
      if (direction === 'up' && i > 0) [notes[i], notes[i-1]] = [notes[i-1], notes[i]];
      else if (direction === 'down' && i < notes.length-1) [notes[i], notes[i+1]] = [notes[i+1], notes[i]];
      renderNotesList();
    }
    function renderNotesList() {
      const list = document.getElementById('notesList');
      list.innerHTML = '';
      notes.forEach((note, i) => {
        const item = document.createElement('div');
        item.className = 'note-item' + (note.id === currentNoteId ? ' active' : '');
        const up = i > 0 ? `<button class="actions-menu-item" onclick="moveNote(${note.id},'up',event)">Up</button>` : `<button class="actions-menu-item disabled">Up</button>`;
        const down = i < notes.length - 1 ? `<button class="actions-menu-item" onclick="moveNote(${note.id},'down',event)">Down</button>` : `<button class="actions-menu-item disabled">Down</button>`;
        item.innerHTML = `
            <span class="note-name" onclick="selectNote(${note.id})">${note.title}</span>
            <div class="actions-container">
                <button class="actions-menu-btn" onclick="toggleActionMenu(event)">‚ãÆ</button>
                <div class="actions-menu">
                    <button class="actions-menu-item" onclick="editNoteTitle(${note.id},event)">Edit</button>
                    ${up} ${down}
                    <button class="actions-menu-item" onclick="deleteNote(${note.id},event)">Delete</button>
                </div>
            </div>`;
        list.appendChild(item);
      });
    }
    function addTask() {
      const text = document.getElementById('taskInput').value.trim();
      if (!text) return;
      tasks.push({ 
        id: Date.now(), text, 
        dueDate: document.getElementById('taskDueDate').value, 
        priority: document.getElementById('taskPriority').value, 
        status: 'todo' 
      });
      document.getElementById('taskInput').value = '';
      renderTasks();
    }
    function moveTask(id, newStatus, event) {
      if (event) event.stopPropagation();
      const task = tasks.find(t => t.id === id);
      if (task) task.status = newStatus;
      renderTasks();
    }
    function deleteTask(id, event) {
      if (event) event.stopPropagation();
      tasks = tasks.filter(t => t.id !== id);
      renderTasks();
    }
    function editTask(id, event) {
      event.stopPropagation();
      const task = tasks.find(t => t.id === id);
      const newText = prompt("New description:", task.text);
      if(newText) task.text = newText;
      renderTasks();
    }
    function renderTasks() {
      const containers = {
        todo: document.getElementById('todo-tasks'),
        inprogress: document.getElementById('inprogress-tasks'),
        done: document.getElementById('done-tasks')
      };
      Object.values(containers).forEach(c => c.innerHTML = '');
      tasks.forEach(task => {
        const card = document.createElement('div');
        card.className = `task-card priority-${task.priority} ${task.status==='done'?'done':''}`;
        let moves = '';
        if (task.status === 'todo') moves = `<button class="actions-menu-item" onclick="moveTask(${task.id},'inprogress',event)">In Progress</button>`;
        else if (task.status === 'inprogress') moves = `<button class="actions-menu-item" onclick="moveTask(${task.id},'todo',event)">To Do</button><button class="actions-menu-item" onclick="moveTask(${task.id},'done',event)">Done</button>`;
        else moves = `<button class="actions-menu-item" onclick="moveTask(${task.id},'inprogress',event)">In Progress</button>`;
        card.innerHTML = `
            <div class="task-card-content"><p>${task.text}</p>${task.dueDate ? `<div class="task-meta">Due: ${task.dueDate}</div>` : ''}</div>
            <div class="actions-container">
                <button class="actions-menu-btn" onclick="toggleActionMenu(event)">‚ãÆ</button>
                <div class="actions-menu">
                    <button class="actions-menu-item" onclick="editTask(${task.id},event)">Edit</button>
                    ${moves}
                    <button class="actions-menu-item" onclick="deleteTask(${task.id},event)">Delete</button>
                </div>
            </div>`;
        containers[task.status].appendChild(card);
      });
    }
    function renderProgress() {
        const tab = document.getElementById('progress');
        const totalLec = subjects.reduce((s, sub) => s + sub.lectures.length, 0);
        const compLec = subjects.reduce((s, sub) => s + sub.lectures.filter(l => l.completed).length, 0);
        const overall = totalLec > 0 ? (compLec/totalLec)*100 : 0;
        const done = tasks.filter(t=>t.status==='done').length;
        let subjectHTML = subjects.map(s => {
            const total = s.lectures.length;
            const comp = s.lectures.filter(l=>l.completed).length;
            const perc = total > 0 ? (comp/total)*100 : 0;
            return `<div class="subject-progress-item"><h4>${s.name} (${comp}/${total})</h4><div class="progress-bar-container"><div class="progress-bar-fill" style="width:${perc}%;"></div><span class="progress-bar-label">${Math.round(perc)}%</span></div></div>`;
        }).join('');
        if (!subjectHTML) subjectHTML = '<p>No subjects yet.</p>';
        tab.innerHTML = `<h2>Progress</h2><div class="progress-container"><div class="progress-summary"><div class="summary-card"><div class="count">${subjects.length}</div><div class="label">Subjects</div></div><div class="summary-card"><div class="count">${totalLec}</div><div class="label">Lectures</div></div><div class="summary-card"><div class="count">${done}</div><div class="label">Tasks Done</div></div></div><h3>Overall Completion</h3><div class="progress-bar-container"><div class="progress-bar-fill" style="width:${overall}%;"></div><span class="progress-bar-label">${compLec}/${totalLec} (${Math.round(overall)}%)</span></div><hr><h3>By Subject</h3><div id="subjectProgressList">${subjectHTML}</div></div>`;
    }
    function renderDashboard() {
        const tab = document.getElementById('dashboard');
        const soon = tasks.filter(t => t.dueDate && new Date(t.dueDate) > new Date() && t.status !== 'done').slice(0, 5);
        let tasksHTML = soon.map(t => `<div class="task-item"><span class="task-name">${t.text}</span><span class="task-due-date">Due: ${t.dueDate}</span></div>`).join('');
        if (!tasksHTML) tasksHTML = '<p>No upcoming tasks.</p>';
        tab.innerHTML = `<h2>Dashboard</h2><div class="dashboard-grid"><div class="dashboard-main"><div class="dashboard-card dashboard-tasks"><h3>Upcoming Tasks</h3><div id="dashboardTaskList">${tasksHTML}</div></div></div></div>`;
    }
    function renderQuizUI() {
        const list = document.getElementById('quizSubjectList');
        if(!list) return;
        list.innerHTML = '';
        if (!subjects.length) { list.innerHTML = '<p>No subjects.</p>'; return; }
        subjects.forEach((s, i) => {
            const div = document.createElement("div");
            div.className = "quiz-subject-item" + (currentQuizSubject === i ? " active" : "");
            div.innerHTML = `<span class="subject-name">${s.name}</span>`;
            div.onclick = () => selectQuizSubject(i);
            list.appendChild(div);
        });
    }
    function selectQuizSubject(i) {
        currentQuizSubject = i;
        document.getElementById('quizSubjectTitle').innerText = subjects[i].name;
        document.getElementById('quizContent').style.display = 'flex';
        renderQuizSubjectView();
        renderQuizUI();
    }
    function renderQuizSubjectView() {
        const area = document.getElementById('quizContent');
        const subject = subjects[currentQuizSubject];
        const hasCards = subject.flashcards && subject.flashcards.length > 0;
        area.innerHTML = `<form id="flashcardForm" onsubmit="addFlashcard(event)"><h4>New Flashcard</h4><textarea id="flashcardFront" placeholder="Front" required></textarea><textarea id="flashcardBack" placeholder="Back" required></textarea><button type="submit" class="primary-btn">+ Add</button></form><hr><h4>Existing (${subject.flashcards.length})</h4>${hasCards ? `<button class="primary-btn" onclick="startQuiz()">Start Quiz</button>` : '<p>No flashcards yet.</p>'}`;
    }
    function addFlashcard(event) {
        event.preventDefault();
        const front = document.getElementById('flashcardFront').value;
        const back = document.getElementById('flashcardBack').value;
        subjects[currentQuizSubject].flashcards.push({ front, back });
        renderQuizSubjectView();
    }
    function startQuiz() { currentQuizCardIndex = 0; renderQuizCard(); }
    function renderQuizCard() {
        const area = document.getElementById('quizContent');
        const cards = subjects[currentQuizSubject].flashcards;
        const card = cards[currentQuizCardIndex];
        area.innerHTML = `<div class="quiz-view"><div class="flashcard" onclick="this.classList.toggle('is-flipped')"><div class="flashcard-face flashcard-face--front">${card.front}</div><div class="flashcard-face flashcard-face--back">${card.back}</div></div><div class="quiz-nav"><button class="primary-btn" onclick="prevCard()">Prev</button><span id="quizCardCounter">${currentQuizCardIndex + 1}/${cards.length}</span><button class="primary-btn" onclick="nextCard()">Next</button></div><button class="primary-btn" onclick="renderQuizSubjectView()">End Quiz</button></div>`;
    }
    function nextCard() { if (currentQuizCardIndex < subjects[currentQuizSubject].flashcards.length - 1) currentQuizCardIndex++; renderQuizCard(); }
    function prevCard() { if (currentQuizCardIndex > 0) currentQuizCardIndex--; renderQuizCard(); }
    const pomodoroDisplay = document.getElementById('pomodoro-display');
    const pomodoroStartBtn = document.getElementById('pomodoro-start');
    const pomodoroResetBtn = document.getElementById('pomodoro-reset');
    let pomodoroInterval; let pomodoroTime = 1500; let currentMode = 'pomodoro';
    const modes = { pomodoro: 1500, shortBreak: 300, longBreak: 900 };
    function updatePomodoroDisplay() {
        const mins = Math.floor(pomodoroTime / 60); const secs = pomodoroTime % 60;
        pomodoroDisplay.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    function setPomodoroMode(mode) {
        currentMode = mode; resetPomodoro();
        document.querySelectorAll('.pomodoro-timer .actions-menu-item').forEach(b=>b.classList.remove('active'));
        document.getElementById(`${mode}-mode`).classList.add('active');
    }
    function startPomodoro() {
        if (pomodoroStartBtn.textContent === 'Start') {
            pomodoroStartBtn.textContent = 'Pause';
            pomodoroInterval = setInterval(() => {
                pomodoroTime--; updatePomodoroDisplay();
                if (pomodoroTime <= 0) { clearInterval(pomodoroInterval); alert("Time's up!"); resetPomodoro(); }
            }, 1000);
        } else { pomodoroStartBtn.textContent = 'Start'; clearInterval(pomodoroInterval); }
    }
    function resetPomodoro() {
        clearInterval(pomodoroInterval);
        pomodoroStartBtn.textContent = 'Start';
        pomodoroTime = modes[currentMode];
        updatePomodoroDisplay();
    }
    pomodoroStartBtn.addEventListener('click', startPomodoro);
    pomodoroResetBtn.addEventListener('click', resetPomodoro);
    
    // --- INITIAL APP RENDER ---
    document.addEventListener('DOMContentLoaded', () => {
        authButton.innerText = 'Loading...';
        authButton.disabled = true;
        authButton.addEventListener('click', handleAuthClick);
        saveButton.addEventListener('click', saveDataToDrive);
        renderAll();
        setPomodoroMode('pomodoro');
        updatePomodoroDisplay();
    });
  </script>
</body>
</html>