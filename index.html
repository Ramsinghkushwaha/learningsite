<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decode+</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* --- AESTHETIC REVAMP --- */
    :root {
        --primary-hue: 125; /* Green */
        --primary-color: hsl(var(--primary-hue), 45%, 48%);
        --primary-dark: hsl(var(--primary-hue), 45%, 38%);
        --primary-light: hsl(var(--primary-hue), 50%, 94%);
        --background-color: #f8f9fc;
        --surface-color: #ffffff;
        --text-color: #2c3e50;
        --text-muted: #8492a6;
        --border-color: #e0e6ed;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --font-family: 'Poppins', sans-serif;
        --border-radius-sm: 4px;
        --border-radius-md: 8px;
        --transition-speed: 0.2s ease;
    }

    /* --- Base & Typography --- */
    *, *::before, *::after {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        font-family: var(--font-family);
        display: flex;
        height: 100vh;
        background: var(--background-color);
        color: var(--text-color);
        font-weight: 400;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        /* overflow: hidden;  <-- THIS LINE WAS THE PROBLEM AND HAS BEEN REMOVED */
    }

    h2, h3, h4 {
        font-weight: 600;
        color: var(--text-color);
        margin-top: 0;
    }
    h2 { font-size: 1.75rem; }
    h3 { font-size: 1.25rem; color: var(--primary-dark); }
    h4 { font-size: 1rem; font-weight: 500;}

    hr {
        border: none;
        border-top: 1px solid var(--border-color);
        margin: 1.5rem 0;
    }

    /* --- Custom Scrollbar --- */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--background-color); }
    ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #bbb; }

    /* --- Sidebar Navigation --- */
    nav {
        width: 240px;
        background: var(--primary-dark);
        color: white;
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
        box-shadow: var(--shadow-lg);
        z-index: 100;
    }
    .nav-buttons { flex-grow: 1; }
    nav h2 {
        text-align: center;
        margin: 0;
        padding: 24px 16px;
        background: rgba(0,0,0,0.2);
        font-size: 1.5rem;
        font-weight: 600;
        color: white;
    }
    nav button {
        padding: 16px 24px;
        border: none;
        background: transparent;
        color: rgba(255, 255, 255, 0.8);
        text-align: left;
        font-size: 1rem;
        font-family: var(--font-family);
        cursor: pointer;
        transition: all var(--transition-speed);
        border-left: 4px solid transparent;
        width: 100%;
    }
    nav button:hover {
        background: rgba(255,255,255,0.05);
        color: white;
    }
    nav button.active {
        background: var(--primary-color);
        color: white;
        font-weight: 600;
        border-left: 4px solid white;
    }

    /* --- Content Area --- */
    .content {
        flex: 1;
        padding: 32px;
        overflow: hidden;
        min-height: 0; /* Added for flexbox stability */
    }
    .tab {
        display: none;
        height: 100%;
        flex-direction: column;
    }
    .tab.active {
        display: flex;
    }
    .tab > h2 { 
        margin-bottom: 24px;
        flex-shrink: 0;
    }
    
    /* --- Forms & Buttons --- */
    input[type="text"], input[type="date"], select, textarea {
        padding: 10px 14px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-md);
        font-size: 1rem;
        font-family: var(--font-family);
        transition: all var(--transition-speed);
        background-color: var(--surface-color);
        width: 100%;
    }
    textarea {
        resize: vertical;
        min-height: 80px;
    }
    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px hsla(var(--primary-hue), 45%, 48%, 0.2);
    }
    
    button {
      font-family: var(--font-family);
      cursor: pointer;
      transition: all var(--transition-speed);
    }
    
    .primary-btn {
        padding: 10px 20px;
        background: var(--primary-color);
        border: none;
        color: white;
        border-radius: var(--border-radius-md);
        font-weight: 500;
        font-size: 1rem;
        box-shadow: var(--shadow);
    }
    .primary-btn:hover { 
        background: var(--primary-dark); 
        box-shadow: var(--shadow-lg);
        transform: translateY(-2px);
    }
    
    /* --- Main Containers & Lists --- */
    .subjects-container, .notes-container, .quizzes-container {
        display: flex;
        flex-grow: 1; 
        min-height: 0; 
    }
    .subject-list, .note-list, .quiz-subject-list {
        width: 280px;
        border-right: 1px solid var(--border-color);
        padding: 16px;
        display: flex;
        flex-direction: column;
        background: var(--surface-color);
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow);
    }
    .subject-list input, .note-list input { width: 100%; box-sizing: border-box; margin-bottom: 8px;}
    .subject-list button, .note-list button { width: 100%; flex-shrink: 0; }
    
    .list-scroll-area {
        flex-grow: 1;
        overflow-y: auto;
        min-height: 0;
        margin-top: 1rem;
    }

    .subject-item, .note-item, .quiz-subject-item {
        padding: 0 12px;
        margin: 4px 0;
        border-radius: var(--border-radius-md);
        cursor: pointer;
        font-weight: 500;
        color: var(--text-muted);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all var(--transition-speed);
    }

    .subject-item .subject-name, .note-item .note-name, .quiz-subject-item .subject-name {
        flex-grow: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding: 12px 0;
    }

    .subject-item:hover, .note-item:hover, .quiz-subject-item:hover { background: var(--primary-light); color: var(--primary-dark); }
    .subject-item.active, .note-item.active, .quiz-subject-item.active {
        background: var(--primary-color);
        color: white;
        font-weight: 500;
        box-shadow: var(--shadow);
    }
    
    .lectures-area, .note-editor-area, .quizzes-area {
        flex: 1;
        padding-left: 24px;
        display: flex;
        flex-direction: column;
        min-height: 0;
    }
    .lectures-area > h3, .note-editor-area > h3, .quizzes-area > h3 {
        margin-bottom: 16px;
        flex-shrink: 0;
    }
    
    /* --- Actions Dropdown Menu --- */
    .actions-container { position: relative; flex-shrink: 0; }
    .actions-menu-btn {
        background: transparent;
        border: none;
        cursor: pointer;
        font-size: 1.25rem;
        font-weight: bold;
        padding: 4px 8px;
        line-height: 1;
        border-radius: var(--border-radius-md);
        color: var(--text-muted);
    }
    .subject-item.active .actions-menu-btn, .note-item.active .actions-menu-btn, .quiz-subject-item.active .actions-menu-btn { color: white; }
    .subject-item:hover .actions-menu-btn, .note-item:hover .actions-menu-btn, .task-card:hover .actions-menu-btn, .quiz-subject-item:hover .actions-menu-btn { color: var(--primary-dark); }
    .actions-menu-btn:hover { background-color: rgba(0,0,0,0.1); }
    .actions-menu {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background-color: var(--surface-color);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow-lg);
        z-index: 10;
        width: 160px;
        padding: 4px 0;
        overflow: hidden;
        animation: fadeIn 0.1s ease-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }
    .actions-menu.show { display: block; }
    .actions-menu-item {
        display: block;
        padding: 10px 14px;
        cursor: pointer;
        font-size: 0.95rem;
        color: var(--text-color);
        background: none;
        border: none;
        width: 100%;
        text-align: left;
    }
    .actions-menu-item:hover { background-color: var(--primary-light); }
    .actions-menu-item.disabled { color: #aaa; cursor: not-allowed; background-color: transparent; }

    /* --- Lecture Card --- */
    #lectureControls { align-items: center; }
    #lectureList { flex-grow: 1; overflow-y: auto; min-height: 0; } 
    .lecture-card {
      display: flex;
      background: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-md);
      padding: 12px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
      align-items: center;
      transition: all var(--transition-speed);
    }
    .lecture-card:hover { 
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-color);
        transform: translateY(-2px);
    }
    .lecture-left iframe {
      width: 160px;
      height: 90px;
      border-radius: var(--border-radius-sm);
      border: 1px solid var(--border-color);
    }
    .lecture-right {
      flex: 1;
      margin-right: 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .lecture-title-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 8px; 
    }
    .lecture-title-header h4 { 
        margin: 0; 
        font-size: 0.95rem;
    }
    .lecture-actions { display: flex; gap: 8px; }
    .lecture-actions button {
        padding: 5px 10px;
        border-radius: var(--border-radius-sm);
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 500;
        border: none;
        transition: all var(--transition-speed);
    }
    .watch-btn { background: var(--primary-light); color: var(--primary-dark); }
    .watch-btn:hover { background: var(--primary-color); color: white; }
    .completed-btn { background-color: #e3f2fd; color: #1e88e5; }
    .completed-btn:hover { background-color: #1e88e5; color: white; }
    .completed-btn.completed { background-color: #e0e0e0; color: #757575; }
    .remove-btn { background: #ffcdd2; color: #c62828; }
    .remove-btn:hover { background: #c62828; color: white; }

    /* --- Task Scheduler --- */
    .task-form {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      background: var(--surface-color);
      padding: 16px;
      border-radius: var(--border-radius-md);
      box-shadow: var(--shadow);
      align-items: center;
      flex-shrink: 0; 
    }
    .task-form input[type="text"] {
        flex: 1 1 auto;
        width: auto;
    }
    .task-form input[type="date"],
    .task-form select,
    .task-form button {
        width: auto;
        flex-shrink: 0;
    }
    
    .task-board { 
        display: flex; 
        gap: 24px; 
        justify-content: space-between; 
        flex-grow: 1;
        min-height: 0;
    }
    .task-column {
      flex: 1;
      background: var(--surface-color);
      padding: 16px;
      border-radius: var(--border-radius-md);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
    }
    .task-column h3 { border-bottom: 1px solid var(--border-color); padding-bottom: 12px; margin-bottom: 16px; }
    .tasks-container { min-height: 0; flex-grow: 1; overflow-y: auto; }
    .task-card {
      background: var(--primary-light);
      padding: 12px;
      border-radius: var(--border-radius-md);
      margin-bottom: 12px;
      box-shadow: none;
      border: 1px solid var(--border-color);
      border-left: 5px solid;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .task-card-content { flex-grow: 1; }
    .task-card.priority-high { border-left-color: #ef5350; }
    .task-card.priority-medium { border-left-color: #ffca28; }
    .task-card.priority-low { border-left-color: #66bb6a; }
    .task-card p { margin: 0 0 4px; font-weight: 500; font-size: 0.95rem;}
    .task-card .task-meta { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0; }
    .task-card.done { text-decoration: line-through; opacity: 0.7; background: #e8f5e9; }

    /* --- Notes Editor --- */
    .note-editor-area #noteEditorContainer {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        min-height: 0;
    }
    .note-toolbar {
        background: var(--surface-color);
        padding: 8px;
        border: 1px solid var(--border-color);
        border-bottom: none;
        border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
        display: flex;
        gap: 4px;
        align-items: center;
    }
    .note-toolbar button {
        padding: 6px 12px;
        border-radius: var(--border-radius-md);
        border: none;
        background: transparent;
    }
    .note-toolbar button:hover { background: var(--primary-light); color: var(--primary-dark); }
    .note-toolbar .remove-btn {
        margin-left: auto;
        font-weight: 500;
        font-size: 0.9rem;
    }
    .note-toolbar .remove-btn:hover {
        background: #ffcdd2;
        color: #c62828;
    }
    #notes-editor {
        width: 100%;
        flex-grow: 1;
        box-sizing: border-box;
        border: 1px solid var(--border-color);
        border-radius: 0 0 var(--border-radius-md) var(--border-radius-md);
        padding: 16px;
        font-size: 1rem;
        line-height: 1.6;
        font-family: var(--font-family);
        overflow-y: auto;
        background: var(--surface-color);
    }
    #notes-editor:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px hsla(var(--primary-hue), 45%, 48%, 0.2);
    }

    /* --- Progress Tab Styles --- */
    .progress-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }
    #progress .progress-container {
      height: 100%;
      overflow-y: auto;
    }
    .summary-card {
        background-color: var(--surface-color);
        padding: 16px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow);
        text-align: center;
        transition: all var(--transition-speed);
    }
    .summary-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-lg);
    }
    .summary-card .count {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
    }
    .summary-card .label {
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-top: 4px;
    }
    .progress-bar-container {
        width: 100%;
        height: 24px;
        background-color: var(--border-color);
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        margin-top: 16px;
    }
    .progress-bar-fill {
        height: 100%;
        background-color: var(--primary-color);
        border-radius: 12px;
        transition: width 0.5s ease-in-out;
    }
    .progress-bar-label {
        position: absolute;
        width: 100%;
        text-align: center;
        line-height: 24px;
        color: white;
        font-weight: 500;
        font-size: 0.8rem;
    }
    #subjectProgressList .subject-progress-item {
        background-color: var(--surface-color);
        padding: 16px;
        border-radius: var(--border-radius-md);
        margin-bottom: 16px;
        box-shadow: var(--shadow);
    }
    .subject-progress-item h4 {
        margin-bottom: 8px;
    }

    /* --- DASHBOARD STYLES --- */
    #dashboard .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
        flex-grow: 1;
        min-height: 0;
        overflow-y: auto;
    }
    .dashboard-main, .dashboard-side {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }
    .dashboard-card {
        background-color: var(--surface-color);
        padding: 24px;
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow);
    }
    .dashboard-tasks .task-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-color);
    }
    .dashboard-tasks .task-item:last-child {
        border-bottom: none;
    }
    .dashboard-tasks .task-name {
        font-weight: 500;
    }
    .dashboard-tasks .task-due-date {
        color: var(--text-muted);
        font-size: 0.9rem;
    }

    /* --- QUIZZES TAB STYLES (REDESIGNED) --- */
    .quiz-management-view {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 24px;
        flex-grow: 1;
        min-height: 0;
    }
    #flashcardForm {
        display: flex;
        flex-direction: column;
        gap: 16px;
        padding: 24px;
        background: var(--surface-color);
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow);
        align-self: flex-start;
    }
    #existingFlashcardsContainer {
        display: flex;
        flex-direction: column;
        min-height: 0;
    }
    #existingFlashcardsList {
        flex-grow: 1;
        overflow-y: auto;
    }
    .flashcard-list-item {
        background: var(--surface-color);
        padding: 12px 16px;
        border-radius: var(--border-radius-md);
        margin-bottom: 12px;
        box-shadow: var(--shadow);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .flashcard-list-item p {
        margin: 0;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .flashcard-list-actions button {
        background: none;
        border: none;
        font-size: 1rem;
        cursor: pointer;
        padding: 4px;
        color: var(--text-muted);
    }
    .flashcard-list-actions button:hover {
        color: var(--primary-dark);
    }

    .quiz-session-view {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex-grow: 1;
        padding-bottom: 50px; /* Space for buttons */
    }
    #quiz-progress-bar-container {
        width: 100%;
        max-width: 600px;
        height: 8px;
        background: var(--border-color);
        border-radius: 4px;
        margin-bottom: 16px;
    }
    #quiz-progress-bar {
        width: 0%;
        height: 100%;
        background: var(--primary-color);
        border-radius: 4px;
        transition: width var(--transition-speed);
    }
    #quiz-card-counter {
        font-weight: 500;
        color: var(--text-muted);
        margin-bottom: 24px;
    }
    .flashcard {
        width: 100%;
        max-width: 600px;
        height: 350px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s;
        cursor: pointer;
    }
    .flashcard.is-flipped {
        transform: rotateY(180deg);
    }
    .flashcard-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
        font-size: 1.75rem;
        background: var(--surface-color);
        box-shadow: var(--shadow-lg);
        border-radius: var(--border-radius-md);
        border: 1px solid var(--border-color);
        text-align: center;
    }
    .flashcard-face--back {
        transform: rotateY(180deg);
        background: var(--primary-light);
        font-size: 1.5rem;
    }
    .quiz-session-controls {
        margin-top: 24px;
        display: flex;
        gap: 16px;
    }
    .quiz-session-controls button {
        padding: 12px 24px;
        font-size: 1rem;
        font-weight: 600;
    }
    .quiz-know-btn {
        background-color: var(--primary-light);
        color: var(--primary-dark);
    }
    .quiz-know-btn:hover {
        background-color: var(--primary-color);
        color: white;
    }
    .quiz-dont-know-btn {
        background-color: #ffcdd2;
        color: #c62828;
    }
     .quiz-dont-know-btn:hover {
        background-color: #c62828;
        color: white;
    }
    .quiz-results-view {
        text-align: center;
    }


    /* --- POMODORO TIMER STYLES (MODIFIED) --- */
    .pomodoro-timer {
        padding: 16px 12px;
        text-align: center;
        color: white;
        margin-top: auto;
        background: rgba(0,0,0,0.2);
    }
    .pomodoro-top-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }
    #pomodoro-display {
        font-size: 1.8rem;
        font-weight: 600;
        flex-shrink: 0;
        margin-left: 12px;
    }
    .pomodoro-modes {
        display: flex;
        flex-direction: column;
        gap: 4px;
        align-items: flex-start;
    }
    .pomodoro-modes button {
        background: transparent;
        color: white;
        border: 1px solid rgba(255,255,255,0.5);
        padding: 3px 8px;
        border-radius: var(--border-radius-md);
        font-size: 0.7rem;
        margin: 0;
        width: auto;
        text-align: center;
        white-space: nowrap;
    }
    .pomodoro-modes button.active {
        background: white;
        color: var(--primary-dark);
        font-weight: 600;
        border-color: white;
    }
    .pomodoro-controls {
        display: flex;
        justify-content: center;
        gap: 8px;
    }
    .pomodoro-controls button {
        background: transparent;
        color: white;
        border: 1px solid rgba(255,255,255,0.7);
        padding: 4px 12px;
        border-radius: var(--border-radius-sm);
        font-size: 0.8rem;
        margin: 0;
    }
    .pomodoro-controls button:hover {
        background: white;
        color: var(--primary-dark);
    }

    /* --- SMARTPHONE FRIENDLY STYLES --- */
    @media (max-width: 768px) {
        /* --- Base layout and font adjustments --- */
        html {
            font-size: 14px;
        }
        
        body {
            flex-direction: column-reverse;
        }

        /* --- Bottom Navigation Bar --- */
        nav {
            width: 100%;
            height: 60px;
            flex-direction: row;
            flex-shrink: 0;
            box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.1);
        }

        nav h2 {
            display: none;
        }

        .nav-buttons {
            display: flex; 
            flex-direction: row; 
            justify-content: space-around;
            align-items: stretch;
            width: 100%;
        }

        nav button {
            flex-grow: 1;
            padding: 8px 4px;
            font-size: 0.8rem; 
            border-left: none;
            border-bottom: 4px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-radius: 0;
        }
        
        nav button.active {
            border-left: none;
            border-bottom: 4px solid white;
        }
        
        .pomodoro-timer {
            display: none;
        }

        /* --- Content and Page Layout Adjustments --- */
        .content {
            padding: 16px;
            overflow-y: auto;
        }

        .tab {
            height: auto;
        }
        
        /* NEW: Reduce width of side panels on mobile to give more space to content */
        .subject-list, .note-list, .quiz-subject-list {
            width: 150px; /* Reduced from 280px for mobile */
            flex-shrink: 0; /* Prevent the panel from shrinking further */
        }
    }

  </style>
</head>
<body>
<nav>
    <div class="nav-buttons">
        <h2>📚 Decode+</h2>
        <button class="active" onclick="openTab(event, 'dashboard')">🏠 Dashboard</button>
        <button onclick="openTab(event, 'subjects')">📖 Subjects</button>
        <button onclick="openTab(event, 'notes')">📔 Notes</button>
        <button onclick="openTab(event, 'tasks')">📅 Tasks</button>
        <button onclick="openTab(event, 'quizzes')">📝 Quizzes</button>
        <button onclick="openTab(event, 'progress')">📊 Progress</button>
    </div>
    <div class="pomodoro-timer">
        <div class="pomodoro-top-row">
            <div class="pomodoro-modes">
                <button id="pomodoro-mode" class="active" onclick="setPomodoroMode('pomodoro')">Pomodoro</button>
                <button id="short-break-mode" onclick="setPomodoroMode('shortBreak')">Short Break</button>
                <button id="long-break-mode" onclick="setPomodoroMode('longBreak')">Long Break</button>
            </div>
            <div id="pomodoro-display">25:00</div>
        </div>
        <div class="pomodoro-controls">
            <button id="pomodoro-start">Start</button>
            <button id="pomodoro-reset">Reset</button>
        </div>
    </div>
  </nav>

  <div class="content">
    <div id="dashboard" class="tab active">
        </div>
    <div id="subjects" class="tab">
      <h2>Subjects & Lectures</h2>
      <div class="subjects-container">
        <div class="subject-list">
          <input id="subjectName" type="text" placeholder="Add New Subject">
          <button class="primary-btn" onclick="addSubject()">+ Add Subject</button>
          <div class="list-scroll-area">
            <hr>
            <div id="subjectList"></div>
          </div>
        </div>
        <div class="lectures-area">
          <h3 id="subjectTitle">Select a subject to view lectures</h3>
          <div id="lectureControls" style="display:none; gap: 10px; margin-bottom: 10px; flex-shrink: 0;">
            <input id="lectureUrl" type="text" placeholder="YouTube link" style="flex: 1;">
            <input id="lectureTitle" type="text" placeholder="Lecture title" style="flex: 1;">
            <button class="primary-btn" onclick="addLecture()">+ Add</button>
          </div>
          <hr id="lectureHr" style="display: none; flex-shrink: 0;">
          <div id="lectureList"></div>
        </div>
      </div>
    </div>
    <div id="quizzes" class="tab">
        <h2>Quizzes & Flashcards</h2>
        <div class="quizzes-container">
            <div class="quiz-subject-list">
                <h3>Select a Subject</h3>
                <div class="list-scroll-area">
                    <div id="quizSubjectList"></div>
                </div>
            </div>
            <div class="quizzes-area">
                <h3 id="quizSubjectTitle">Select a subject to manage flashcards</h3>
                <div id="quizContent" style="display: none; flex-grow: 1; min-height: 0; display: flex; flex-direction: column;">
                </div>
            </div>
        </div>
    </div>
    <div id="progress" class="tab">
        </div>
    <div id="notes" class="tab">
      <h2>My Notes</h2>
      <div class="notes-container">
        <div class="note-list">
          <input id="noteTitleInput" type="text" placeholder="New Note Title">
          <button class="primary-btn" onclick="addNote()">+ Add Note</button>
          <div class="list-scroll-area">
            <hr>
            <div id="notesList"></div>
          </div>
        </div>
        <div class="note-editor-area">
          <h3 id="currentNoteTitle">Select a note to get started</h3>
          <div id="noteEditorContainer" style="display:none;">
              <div class="note-toolbar">
                  <button title="Bold" onclick="formatDoc('bold')"><b>B</b></button>
                  <button title="Bulleted List" onclick="formatDoc('insertUnorderedList')">●</button>
                  <button title="Numbered List" onclick="formatDoc('insertOrderedList')">1.</button>
                  <button title="Highlight" onclick="formatDoc('backColor', '#FFFFA7')">🎨</button>
                  <button title="Remove Highlight" onclick="formatDoc('backColor', 'white')">🚫</button>
                  <button class="remove-btn" onclick="deleteCurrentNote()">Delete Note</button>
              </div>
              <div id="notes-editor" contenteditable="true" oninput="handleNoteAutosave()"></div>
          </div>
        </div>
      </div>
    </div>
    <div id="tasks" class="tab">
      <h2>Task Scheduler</h2>
      <div class="task-form">
        <input type="text" id="taskInput" placeholder="New task description...">
        <input type="date" id="taskDueDate">
        <select id="taskPriority">
          <option value="low">Low Priority</option>
          <option value="medium">Medium Priority</option>
          <option value="high">High Priority</option>
        </select>
        <button class="primary-btn" onclick="addTask()">+ Add Task</button>
      </div>
      <div class="task-board">
        <div class="task-column">
          <h3>To Do</h3>
          <div class="tasks-container" id="todo-tasks"></div>
        </div>
        <div class="task-column">
          <h3>In Progress</h3>
          <div class="tasks-container" id="inprogress-tasks"></div>
        </div>
        <div class="task-column">
          <h3>Done</h3>
          <div class="tasks-container" id="done-tasks"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Tab navigation
    function openTab(event, id) {
      document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.currentTarget.classList.add('active');
      document.getElementById(id).classList.add('active');

      if (id === 'progress') renderProgress();
      if (id === 'dashboard') renderDashboard();
      if (id === 'quizzes') renderQuizUI();
    }

    // --- HELPER FUNCTIONS FOR ACTION MENUS ---
    function toggleActionMenu(event) {
        event.stopPropagation();
        closeAllActionMenus(event.currentTarget);
        const menu = event.currentTarget.nextElementSibling;
        menu.classList.toggle('show');
    }
    function closeAllActionMenus(exceptElement = null) {
        document.querySelectorAll('.actions-menu.show').forEach(menu => {
            if (!exceptElement || !exceptElement.parentElement.contains(menu)) {
                menu.classList.remove('show');
            }
        });
    }
    window.addEventListener('click', () => {
        closeAllActionMenus();
    });

    // --- DATA STORAGE ---
    function saveSubjects() { localStorage.setItem('lmsSubjects', JSON.stringify(subjects)); }
    function loadSubjects() {
        const stored = localStorage.getItem('lmsSubjects');
        if (stored) {
            subjects = JSON.parse(stored);
            subjects.forEach(s => { if (!s.flashcards) s.flashcards = []; });
        }
    }
    function saveNotes() { localStorage.setItem('lmsNotes', JSON.stringify(notes)); }
    function loadNotes() {
        const stored = localStorage.getItem('lmsNotes');
        if (stored) notes = JSON.parse(stored);
    }
    function saveTasks() { localStorage.setItem('lmsTasks', JSON.stringify(tasks)); }
    function loadTasks() {
        const stored = localStorage.getItem('lmsTasks');
        if (stored) tasks = JSON.parse(stored);
    }

    // --- SUBJECTS & LECTURES SCRIPT ---
    let subjects = [];
    let currentSubject = null;

    function addSubject() {
      const name = document.getElementById('subjectName').value.trim();
      if (!name) return alert("Enter subject name");
      subjects.push({ name, lectures: [], flashcards: [] });
      document.getElementById('subjectName').value = "";
      saveSubjects();
      renderSubjects();
    }
    function renderSubjects() {
      const list = document.getElementById('subjectList');
      if (!list) return;
      list.innerHTML = "";
      subjects.forEach((s, i) => {
        const div = document.createElement("div");
        div.className = "subject-item" + (currentSubject === i ? " active" : "");

        const moveUpHTML = i > 0 ? `<button class="actions-menu-item" onclick="moveSubject(${i}, 'up', event)">Move Up</button>` : `<button class="actions-menu-item disabled" disabled>Move Up</button>`;
        const moveDownHTML = i < subjects.length - 1 ? `<button class="actions-menu-item" onclick="moveSubject(${i}, 'down', event)">Move Down</button>` : `<button class="actions-menu-item disabled" disabled>Move Down</button>`;
        
        div.innerHTML = `
            <span class="subject-name" onclick="selectSubject(${i})">${s.name}</span>
            <div class="actions-container">
                <button class="actions-menu-btn" onclick="toggleActionMenu(event)">⋮</button>
                <div class="actions-menu">
                    <button class="actions-menu-item" onclick="editSubject(${i}, event)">Edit Title</button>
                    ${moveUpHTML}
                    ${moveDownHTML}
                    <button class="actions-menu-item" onclick="deleteSubject(${i}, event)">Delete</button>
                </div>
            </div>
        `;
        list.appendChild(div);
      });
    }
    function selectSubject(index) {
      currentSubject = index;
      document.getElementById('subjectTitle').innerText = subjects[index].name;
      document.getElementById('lectureControls').style.display = "flex";
      document.getElementById('lectureHr').style.display = "block";
      renderSubjects();
      renderLectures();
    }
    function editSubject(index, event) {
        event.stopPropagation();
        const subject = subjects[index];
        const newName = prompt("Enter new name for subject:", subject.name);
        if (newName && newName.trim() !== "") {
            subject.name = newName.trim();
            if (currentSubject === index) {
                document.getElementById('subjectTitle').innerText = subject.name;
            }
            saveSubjects();
            renderSubjects();
        }
    }
    function deleteSubject(index, event) {
        event.stopPropagation();
        if (confirm(`Are you sure you want to delete "${subjects[index].name}"? This will delete all its content.`)) {
            if (currentSubject === index) {
                currentSubject = null;
                document.getElementById('subjectTitle').innerText = "Select a subject";
                document.getElementById('lectureControls').style.display = "none";
                document.getElementById('lectureHr').style.display = "none";
                document.getElementById('lectureList').innerHTML = "";
            } else if (currentSubject > index) {
                currentSubject--;
            }
            subjects.splice(index, 1);
            saveSubjects();
            renderSubjects();
        }
    }
    function moveSubject(index, direction, event) {
        event.stopPropagation();
        if (direction === 'up' && index > 0) {
            [subjects[index], subjects[index - 1]] = [subjects[index - 1], subjects[index]];
            if (currentSubject === index) currentSubject = index - 1;
            else if (currentSubject === index - 1) currentSubject = index;
        } else if (direction === 'down' && index < subjects.length - 1) {
            [subjects[index], subjects[index + 1]] = [subjects[index + 1], subjects[index]];
            if (currentSubject === index) currentSubject = index + 1;
            else if (currentSubject === index + 1) currentSubject = index;
        }
        saveSubjects();
        renderSubjects();
    }
    function addLecture() {
      if (currentSubject === null) return alert("Select a subject first");
      const url = document.getElementById('lectureUrl').value.trim();
      const title = document.getElementById('lectureTitle').value.trim() || "Untitled";
      if (!url) return alert("Enter YouTube link");
      subjects[currentSubject].lectures.push({ title, url, completed: false });
      document.getElementById('lectureUrl').value = "";
      document.getElementById('lectureTitle').value = "";
      saveSubjects();
      renderLectures();
    }
    function renderLectures() {
      const list = document.getElementById('lectureList');
      list.innerHTML = "";
      if (currentSubject === null || !subjects[currentSubject]) return;
      const lectures = subjects[currentSubject].lectures;
      lectures.forEach((lec, i) => {
        const div = document.createElement("div");
        div.className = "lecture-card";

        const moveUpHTML = i > 0 ? `<button class="actions-menu-item" onclick="moveLecture(${i}, 'up', event)">Move Up</button>` : `<button class="actions-menu-item disabled" disabled>Move Up</button>`;
        const moveDownHTML = i < lectures.length - 1 ? `<button class="actions-menu-item" onclick="moveLecture(${i}, 'down', event)">Move Down</button>` : `<button class="actions-menu-item disabled" disabled>Move Down</button>`;

        div.innerHTML = `
          <div class="lecture-right">
            <div class="lecture-title-header">
                <h4>${lec.completed ? "✔ " : ""}${lec.title}</h4>
                <div class="actions-container">
                    <button class="actions-menu-btn" onclick="toggleActionMenu(event)">⋮</button>
                    <div class="actions-menu">
                        <button class="actions-menu-item" onclick="editLectureTitle(${i}, event)">Edit Title</button>
                        ${moveUpHTML}
                        ${moveDownHTML}
                        <button class="actions-menu-item" onclick="removeLecture(${i}, event)">Remove</button>
                    </div>
                </div>
            </div>
            <div class="lecture-actions">
              <button class="watch-btn" onclick="window.open('${lec.url}', '_blank')">▶ Watch</button>
              <button class="completed-btn ${lec.completed ? "completed" : ""}" onclick="toggleCompleted(${i})">${lec.completed ? "✔ Completed" : "Mark as Done"}</button>
            </div>
          </div>
          <div class="lecture-left"><iframe src="${convertToEmbed(lec.url)}"></iframe></div>
          `;
        list.appendChild(div);
      });
    }
    function toggleCompleted(i) {
      subjects[currentSubject].lectures[i].completed = !subjects[currentSubject].lectures[i].completed;
      saveSubjects();
      renderLectures();
    }
    function removeLecture(i, event) {
      if (event) event.stopPropagation();
      subjects[currentSubject].lectures.splice(i, 1);
      saveSubjects();
      renderLectures();
    }
    function editLectureTitle(lectureIndex, event) {
        event.stopPropagation();
        const lecture = subjects[currentSubject].lectures[lectureIndex];
        const newTitle = prompt("Enter new lecture title:", lecture.title);
        if (newTitle && newTitle.trim() !== "") {
            lecture.title = newTitle.trim();
            saveSubjects();
            renderLectures();
        }
    }
    function moveLecture(index, direction, event) {
        event.stopPropagation();
        const lectures = subjects[currentSubject].lectures;
        if (direction === 'up' && index > 0) {
            [lectures[index], lectures[index - 1]] = [lectures[index - 1], lectures[index]];
        } else if (direction === 'down' && index < lectures.length - 1) {
            [lectures[index], lectures[index + 1]] = [lectures[index + 1], lectures[index]];
        }
        saveSubjects();
        renderLectures();
    }
    function convertToEmbed(url) {
      try {
        const u = new URL(url);
        if (u.hostname.includes("youtu.be")) return "https://www.youtube.com/embed/" + u.pathname.slice(1);
        if (u.searchParams.get("v")) return "https://www.youtube.com/embed/" + u.searchParams.get("v");
        return url;
      } catch { return url; }
    }

    // --- SCRIPT FOR MULTIPLE NOTES (RICH TEXT) ---
    let notes = [];
    let currentNoteId = null;

    function formatDoc(command, value = null) {
      document.execCommand(command, false, value);
      document.getElementById('notes-editor').focus();
    }
    
    function addNote() {
      const titleInput = document.getElementById('noteTitleInput');
      const title = titleInput.value.trim();
      if (!title) return alert("Please enter a title for the note.");
      
      const newNote = { id: Date.now(), title: title, content: `<p>This is your new note: <b>${title}</b></p>` };
      notes.push(newNote);
      titleInput.value = '';
      saveNotes();
      renderNotesList();
      selectNote(newNote.id);
    }
    function selectNote(noteId) {
      currentNoteId = noteId;
      const note = notes.find(n => n.id === noteId);
      if (!note) return;

      document.getElementById('currentNoteTitle').innerText = note.title;
      document.getElementById('notes-editor').innerHTML = note.content;
      document.getElementById('noteEditorContainer').style.display = 'flex';
      renderNotesList();
    }
    function deleteCurrentNote() {
        if (currentNoteId === null) return;
        deleteNote(currentNoteId);
    }
    function deleteNote(noteId, event) {
        if (event) event.stopPropagation();
        const noteIndex = notes.findIndex(n => n.id === noteId);
        if (noteIndex === -1) return;

        if (!confirm(`Are you sure you want to delete the note "${notes[noteIndex].title}"?`)) return;

        notes.splice(noteIndex, 1);
        saveNotes();
        
        if (currentNoteId === noteId) {
            currentNoteId = null;
            document.getElementById('currentNoteTitle').innerText = "Select a note to get started";
            document.getElementById('notes-editor').innerHTML = '';
            document.getElementById('noteEditorContainer').style.display = 'none';
        }
        renderNotesList();
    }
    function editNoteTitle(noteId, event) {
        event.stopPropagation();
        const note = notes.find(n => n.id === noteId);
        if (!note) return;
        const newTitle = prompt("Enter new title for the note:", note.title);
        if (newTitle && newTitle.trim() !== "") {
            note.title = newTitle.trim();
            if (currentNoteId === noteId) {
                document.getElementById('currentNoteTitle').innerText = note.title;
            }
            saveNotes();
            renderNotesList();
        }
    }
    function moveNote(noteId, direction, event) {
        event.stopPropagation();
        const index = notes.findIndex(n => n.id === noteId);

        if (direction === 'up' && index > 0) {
            [notes[index], notes[index - 1]] = [notes[index - 1], notes[index]];
        } else if (direction === 'down' && index < notes.length - 1) {
            [notes[index], notes[index + 1]] = [notes[index + 1], notes[index]];
        }
        saveNotes();
        renderNotesList();
    }
    function renderNotesList() {
      const listEl = document.getElementById('notesList');
      listEl.innerHTML = '';
      notes.forEach((note, i) => {
        const item = document.createElement('div');
        item.className = 'note-item';
        if (note.id === currentNoteId) {
          item.classList.add('active');
        }

        const moveUpHTML = i > 0 ? `<button class="actions-menu-item" onclick="moveNote(${note.id}, 'up', event)">Move Up</button>` : `<button class="actions-menu-item disabled" disabled>Move Up</button>`;
        const moveDownHTML = i < notes.length - 1 ? `<button class="actions-menu-item" onclick="moveNote(${note.id}, 'down', event)">Move Down</button>` : `<button class="actions-menu-item disabled" disabled>Move Down</button>`;

        item.innerHTML = `
            <span class="note-name" onclick="selectNote(${note.id})">${note.title}</span>
            <div class="actions-container">
                <button class="actions-menu-btn" onclick="toggleActionMenu(event)">⋮</button>
                <div class="actions-menu">
                    <button class="actions-menu-item" onclick="editNoteTitle(${note.id}, event)">Edit Title</button>
                    ${moveUpHTML}
                    ${moveDownHTML}
                    <button class="actions-menu-item" onclick="deleteNote(${note.id}, event)">Delete</button>
                </div>
            </div>
        `;
        listEl.appendChild(item);
      });
    }
    function handleNoteAutosave() {
        if (currentNoteId !== null) {
            const note = notes.find(n => n.id === currentNoteId);
            if (note) {
                note.content = document.getElementById('notes-editor').innerHTML;
                saveNotes();
            }
        }
    }

    // --- TASK SCHEDULER SCRIPT ---
    let tasks = [];
    function addTask() {
      const taskInput = document.getElementById('taskInput');
      const dueDateInput = document.getElementById('taskDueDate');
      const priorityInput = document.getElementById('taskPriority');
      const text = taskInput.value.trim();
      if (!text) return alert("Please enter a task description.");
      tasks.push({ id: Date.now(), text: text, dueDate: dueDateInput.value, priority: priorityInput.value, status: 'todo' });
      taskInput.value = '';
      dueDateInput.value = '';
      priorityInput.value = 'low';
      saveTasks();
      renderTasks();
    }
    function moveTask(taskId, newStatus, event) {
      if(event) event.stopPropagation();
      const task = tasks.find(t => t.id === taskId);
      if (task) { 
          task.status = newStatus; 
          saveTasks();
          renderTasks(); 
      }
    }
    function deleteTask(taskId, event) {
      if(event) event.stopPropagation();
      tasks = tasks.filter(t => t.id !== taskId);
      saveTasks();
      renderTasks();
    }
    function editTask(taskId, event) {
        event.stopPropagation();
        const task = tasks.find(t => t.id === taskId);
        if (!task) return;

        const newText = prompt("Enter new task description:", task.text);
        if (newText === null) return; 

        const newDueDate = prompt("Enter new due date (YYYY-MM-DD):", task.dueDate);
        if (newDueDate === null) return;

        const newPriority = prompt("Enter new priority (low, medium, high):", task.priority);
        if (newPriority === null) return;

        task.text = newText.trim();
        task.dueDate = newDueDate.trim();
        if (['low', 'medium', 'high'].includes(newPriority.toLowerCase())) {
            task.priority = newPriority.toLowerCase();
        } else {
            alert("Invalid priority. Please enter 'low', 'medium', or 'high'.");
        }
        
        saveTasks();
        renderTasks();
    }
    function renderTasks() {
      const containers = {
        todo: document.getElementById('todo-tasks'),
        inprogress: document.getElementById('inprogress-tasks'),
        done: document.getElementById('done-tasks')
      };
      Object.values(containers).forEach(c => c.innerHTML = '');
      tasks.forEach(task => {
        const taskCard = document.createElement('div');
        taskCard.className = `task-card priority-${task.priority} ${task.status === 'done' ? 'done' : ''}`;
        
        let moveMenuItems = '';
        if (task.status === 'todo') {
            moveMenuItems = `<button class="actions-menu-item" onclick="moveTask(${task.id}, 'inprogress', event)">Move to In Progress</button>`;
        } else if (task.status === 'inprogress') {
            moveMenuItems = `
                <button class="actions-menu-item" onclick="moveTask(${task.id}, 'todo', event)">Move to To Do</button>
                <button class="actions-menu-item" onclick="moveTask(${task.id}, 'done', event)">Move to Done</button>`;
        } else { // done
            moveMenuItems = `<button class="actions-menu-item" onclick="moveTask(${task.id}, 'inprogress', event)">Move to In Progress</button>`;
        }
        
        taskCard.innerHTML = `
            <div class="task-card-content">
                <p>${task.text}</p>
                ${task.dueDate ? `<div class="task-meta">Due: ${task.dueDate}</div>` : ''}
            </div>
            <div class="actions-container">
                <button class="actions-menu-btn" onclick="toggleActionMenu(event)">⋮</button>
                <div class="actions-menu">
                    <button class="actions-menu-item" onclick="editTask(${task.id}, event)">Edit</button>
                    ${moveMenuItems}
                    <button class="actions-menu-item" onclick="deleteTask(${task.id}, event)">Delete</button>
                </div>
            </div>`;
        containers[task.status].appendChild(taskCard);
      });
    }
    
    // --- PROGRESS TAB SCRIPT ---
    function renderProgress() {
        const progressTab = document.getElementById('progress');

        const totalSubjects = subjects.length;
        const totalLectures = subjects.reduce((sum, subject) => sum + subject.lectures.length, 0);
        const completedLectures = subjects.reduce((sum, subject) => {
            return sum + subject.lectures.filter(lec => lec.completed).length;
        }, 0);
        const overallPercentage = totalLectures > 0 ? (completedLectures / totalLectures) * 100 : 0;
        
        const doneTasks = tasks.filter(task => task.status === 'done').length;
        const todoTasks = tasks.filter(task => task.status === 'todo').length;
        const inprogressTasks = tasks.filter(task => task.status === 'inprogress').length;

        let subjectProgressHTML = '';
        if (subjects.length > 0) {
            subjects.forEach(subject => {
                const subjectTotal = subject.lectures.length;
                const subjectCompleted = subject.lectures.filter(lec => lec.completed).length;
                const subjectPercentage = subjectTotal > 0 ? (subjectCompleted / subjectTotal) * 100 : 0;
                subjectProgressHTML += `
                    <div class="subject-progress-item">
                        <h4>${subject.name} <span style="font-weight: 400; color: var(--text-muted); font-size: 0.9rem;">(${subjectCompleted}/${subjectTotal})</span></h4>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: ${subjectPercentage}%;"></div>
                            <span class="progress-bar-label">${Math.round(subjectPercentage)}%</span>
                        </div>
                    </div>
                `;
            });
        } else {
            subjectProgressHTML = '<p>No subjects added yet. Add a subject and some lectures to track your progress!</p>';
        }

        progressTab.innerHTML = `
            <h2>Your Progress</h2>
            <div class="progress-container">
                <div class="progress-summary">
                    <div class="summary-card">
                        <div class="count">${totalSubjects}</div>
                        <div class="label">Subjects</div>
                    </div>
                    <div class="summary-card">
                        <div class="count">${totalLectures}</div>
                        <div class="label">Lectures</div>
                    </div>
                    <div class="summary-card">
                        <div class="count">${doneTasks}</div>
                        <div class="label">Tasks Done</div>
                    </div>
                </div>
                <h3>Overall Lecture Completion</h3>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" style="width: ${overallPercentage}%;"></div>
                    <span class="progress-bar-label">${completedLectures} / ${totalLectures} Lectures Completed (${Math.round(overallPercentage)}%)</span>
                </div>
                <hr>
                <h3>Task Breakdown</h3>
                <div class="progress-summary">
                     <div class="summary-card">
                        <div class="count">${todoTasks}</div>
                        <div class="label">To Do</div>
                    </div>
                    <div class="summary-card">
                        <div class="count">${inprogressTasks}</div>
                        <div class="label">In Progress</div>
                    </div>
                    <div class="summary-card">
                        <div class="count">${doneTasks}</div>
                        <div class="label">Done</div>
                    </div>
                </div>
                <hr>
                <h3>Progress by Subject</h3>
                <div id="subjectProgressList">
                    ${subjectProgressHTML}
                </div>
            </div>
        `;
    }

    // --- DASHBOARD SCRIPT ---
    function renderDashboard() {
        const dashboardTab = document.getElementById('dashboard');
        
        const today = new Date();
        const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
        
        const tasksDueSoon = tasks.filter(task => {
            if (!task.dueDate) return false;
            const dueDate = new Date(task.dueDate);
            return dueDate >= today && dueDate <= nextWeek && task.status !== 'done';
        }).sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

        let tasksHTML = '<p>No tasks due in the next 7 days.</p>';
        if (tasksDueSoon.length > 0) {
            tasksHTML = tasksDueSoon.map(task => `
                <div class="task-item">
                    <span class="task-name">${task.text}</span>
                    <span class="task-due-date">Due: ${task.dueDate}</span>
                </div>
            `).join('');
        }
        
        const totalLectures = subjects.reduce((sum, subject) => sum + subject.lectures.length, 0);
        const completedLectures = subjects.reduce((sum, subject) => sum + subject.lectures.filter(l => l.completed).length, 0);
        const doneTasks = tasks.filter(t => t.status === 'done').length;

        dashboardTab.innerHTML = `
            <h2>Dashboard</h2>
            <div class="dashboard-grid">
                <div class="dashboard-main">
                    <div class="dashboard-card dashboard-tasks">
                        <h3>Tasks Due Soon (Next 7 Days)</h3>
                        <div id="dashboardTaskList">${tasksHTML}</div>
                    </div>
                </div>
                <div class="dashboard-side">
                    <div class="dashboard-card">
                        <h3>At a Glance</h3>
                        <div class="progress-summary">
                            <div class="summary-card">
                                <div class="count">${subjects.length}</div>
                                <div class="label">Subjects</div>
                            </div>
                            <div class="summary-card">
                                <div class="count">${completedLectures}/${totalLectures}</div>
                                <div class="label">Lectures Done</div>
                            </div>
                             <div class="summary-card">
                                <div class="count">${doneTasks}</div>
                                <div class="label">Tasks Done</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // --- QUIZ SCRIPT ---
    let currentQuizSubject = null;
    let currentQuizCardIndex = 0;
    
    function renderQuizUI() {
        const list = document.getElementById('quizSubjectList');
        list.innerHTML = '';
        if (subjects.length === 0) {
            list.innerHTML = '<p>No subjects created. Please add a subject first.</p>';
            return;
        }
        subjects.forEach((s, i) => {
            const div = document.createElement("div");
            div.className = "quiz-subject-item" + (currentQuizSubject === i ? " active" : "");
            div.innerHTML = `<span class="subject-name">${s.name}</span>`;
            div.onclick = () => selectQuizSubject(i);
            list.appendChild(div);
        });
    }

    function selectQuizSubject(index) {
        currentQuizSubject = index;
        document.getElementById('quizSubjectTitle').innerText = subjects[index].name;
        document.getElementById('quizContent').style.display = 'flex';
        renderQuizSubjectView();
        renderQuizUI(); // To update active state
    }

    function renderQuizSubjectView() {
        const contentArea = document.getElementById('quizContent');
        const subject = subjects[currentQuizSubject];
        const hasFlashcards = subject.flashcards && subject.flashcards.length > 0;

        contentArea.innerHTML = `
            <form id="flashcardForm" onsubmit="addFlashcard(event)">
                <h4>Add a New Flashcard</h4>
                <textarea id="flashcardFront" placeholder="Front of the card (Question/Term)" required></textarea>
                <textarea id="flashcardBack" placeholder="Back of the card (Answer/Definition)" required></textarea>
                <button type="submit" class="primary-btn" style="align-self: flex-start;">+ Add Card</button>
            </form>
            <hr>
            <h4>Existing Flashcards (${subject.flashcards.length})</h4>
            ${hasFlashcards ? `<button class="primary-btn" style="align-self: flex-start; margin-bottom: 16px;" onclick="startQuiz()">Start Quiz</button>` : '<p>No flashcards yet. Add one above to start a quiz!</p>'}
        `;
    }

    function addFlashcard(event) {
        event.preventDefault();
        const front = document.getElementById('flashcardFront').value;
        const back = document.getElementById('flashcardBack').value;
        
        const subject = subjects[currentQuizSubject];
        subject.flashcards.push({ front, back });
        saveSubjects();
        renderQuizSubjectView(); // Refresh the view
    }
    
    function startQuiz() {
        currentQuizCardIndex = 0;
        renderQuizCard();
    }
    
    function renderQuizCard() {
        const contentArea = document.getElementById('quizContent');
        const flashcards = subjects[currentQuizSubject].flashcards;
        const card = flashcards[currentQuizCardIndex];
        
        contentArea.innerHTML = `
            <div class="quiz-view">
                <div class="flashcard" onclick="this.classList.toggle('is-flipped')">
                    <div class="flashcard-face flashcard-face--front">${card.front}</div>
                    <div class="flashcard-face flashcard-face--back">${card.back}</div>
                </div>
                <div class="quiz-nav">
                    <button class="primary-btn" onclick="prevCard()">Previous</button>
                    <span id="quizCardCounter">${currentQuizCardIndex + 1} / ${flashcards.length}</span>
                    <button class="primary-btn" onclick="nextCard()">Next</button>
                </div>
                <button class="primary-btn" style="margin-top: 24px;" onclick="renderQuizSubjectView()">End Quiz</button>
            </div>
        `;
    }

    function nextCard() {
        const flashcards = subjects[currentQuizSubject].flashcards;
        if (currentQuizCardIndex < flashcards.length - 1) {
            currentQuizCardIndex++;
            renderQuizCard();
        }
    }
    function prevCard() {
        if (currentQuizCardIndex > 0) {
            currentQuizCardIndex--;
            renderQuizCard();
        }
    }


    // --- POMODORO TIMER SCRIPT ---
    const pomodoroDisplay = document.getElementById('pomodoro-display');
    const pomodoroStartBtn = document.getElementById('pomodoro-start');
    const pomodoroResetBtn = document.getElementById('pomodoro-reset');
    const modeButtons = document.querySelectorAll('.pomodoro-modes button');
    
    let pomodoroInterval;
    let pomodoroTime = 1500; // 25 minutes in seconds
    let currentMode = 'pomodoro';
    
    const modes = {
        pomodoro: 1500,
        shortBreak: 300,
        longBreak: 900,
    };

    function updatePomodoroDisplay() {
        const minutes = Math.floor(pomodoroTime / 60);
        const seconds = pomodoroTime % 60;
        pomodoroDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    function setPomodoroMode(mode) {
        currentMode = mode;
        resetPomodoro();
        modeButtons.forEach(btn => btn.classList.remove('active'));
        document.getElementById(`${mode}-mode`).classList.add('active');
    }

    function startPomodoro() {
        if (pomodoroStartBtn.textContent === 'Start') {
            pomodoroStartBtn.textContent = 'Pause';
            pomodoroInterval = setInterval(() => {
                pomodoroTime--;
                updatePomodoroDisplay();
                if (pomodoroTime <= 0) {
                    clearInterval(pomodoroInterval);
                    alert("Time's up!");
                    resetPomodoro();
                }
            }, 1000);
        } else {
            pomodoroStartBtn.textContent = 'Start';
            clearInterval(pomodoroInterval);
        }
    }
    
    function resetPomodoro() {
        clearInterval(pomodoroInterval);
        pomodoroStartBtn.textContent = 'Start';
        pomodoroTime = modes[currentMode];
        updatePomodoroDisplay();
    }

    pomodoroStartBtn.addEventListener('click', startPomodoro);
    pomodoroResetBtn.addEventListener('click', resetPomodoro);
    
    
    // --- INITIAL APP RENDER ---
    document.addEventListener('DOMContentLoaded', () => {
        loadSubjects();
        loadNotes();
        loadTasks();

        if (tasks.length === 0) {
            tasks = [
                { id: 1, text: "Finish project proposal", dueDate: "2025-09-13", priority: "high", status: "todo" },
                { id: 2, text: "Read Chapter 4 of Physics", dueDate: "2025-09-14", priority: "medium", status: "inprogress" },
                { id: 3, text: "Submit Math assignment", dueDate: "2025-09-11", priority: "high", status: "done" }
            ];
        }
        
        renderSubjects();
        renderNotesList();
        renderTasks();
        renderDashboard(); 
        renderProgress();
        renderQuizUI();
        updatePomodoroDisplay();
    });

  </script>
</body>
</html>